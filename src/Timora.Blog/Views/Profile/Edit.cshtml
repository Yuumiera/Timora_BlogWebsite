@model Timora.Blog.Models.ViewModels.ProfileEditViewModel
@{
    ViewData["Title"] = "Profili Düzenle";
}

<div class="row justify-content-center">
    <div class="col-lg-8 col-xl-7">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-transparent border-0 pb-0 pt-4 px-4">
                <h1 class="h3 mb-0 text-success-emphasis">Profili Düzenle</h1>
                <p class="text-muted small mb-0 mt-2">Profil bilgilerinizi güncelleyin ve kişiselleştirin.</p>
            </div>
            <div class="card-body p-4 p-lg-5">
                <form asp-action="Edit" asp-controller="Profile" method="post" enctype="multipart/form-data" id="profileForm">
                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="Id" />
                    <input type="hidden" asp-for="CurrentProfileImageUrl" />
                    
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                    <!-- Profil Fotoğrafı -->
                    <div class="mb-4 text-center">
                        <label class="form-label fw-semibold d-block mb-3">
                            Profil Fotoğrafı
                        </label>
                        <div class="profile-image-upload-wrapper d-inline-block">
                            @if (!string.IsNullOrWhiteSpace(Model.CurrentProfileImageUrl))
                            {
                                <div class="mb-3">
                                    <img src="@Model.CurrentProfileImageUrl" 
                                         alt="Mevcut profil fotoğrafı" 
                                         class="rounded-circle border border-3 border-success-subtle" 
                                         style="width:140px;height:140px;object-fit:cover;"
                                         id="currentProfileImage" />
                                </div>
                            }
                            else
                            {
                                <div class="mb-3">
                                    <div class="placeholder-avatar rounded-circle d-flex align-items-center justify-content-center mx-auto" 
                                         style="width:140px;height:140px;font-size:2.5rem;"
                                         id="currentProfileImage">
                                        <span>@(Model.FirstName?.FirstOrDefault().ToString().ToUpper() ?? "U")</span>
                                    </div>
                                </div>
                            }
                            
                            <input type="file" 
                                   asp-for="ProfileImage" 
                                   class="form-control" 
                                   accept="image/*" 
                                   id="profileImageInput" />
                            <div class="form-text mt-2">JPG, PNG veya GIF formatında, maksimum 5MB</div>
                            
                            <!-- Yeni Görsel Önizleme -->
                            <div id="imagePreview" class="image-preview-container mt-3" style="display: none;">
                                <p class="small text-muted mb-2">Yeni profil fotoğrafı önizlemesi:</p>
                                <div class="image-preview-wrapper d-inline-block">
                                    <img id="previewImage" src="" alt="Önizleme" class="preview-image rounded-circle" style="width:140px;height:140px;object-fit:cover;" />
                                    <button type="button" class="btn-remove-image" id="removeImageBtn" aria-label="Görseli kaldır">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <span asp-validation-for="ProfileImage" class="text-danger"></span>
                    </div>

                    <!-- Ad Soyad -->
                    <div class="row mb-4">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <label asp-for="FirstName" class="form-label fw-semibold">
                                Ad <span class="text-danger">*</span>
                            </label>
                            <input asp-for="FirstName" 
                                   class="form-control form-control-lg" 
                                   placeholder="Adınızı girin..." />
                            <span asp-validation-for="FirstName" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="LastName" class="form-label fw-semibold">
                                Soyad <span class="text-danger">*</span>
                            </label>
                            <input asp-for="LastName" 
                                   class="form-control form-control-lg" 
                                   placeholder="Soyadınızı girin..." />
                            <span asp-validation-for="LastName" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Doğum Tarihi ve Cinsiyet -->
                    <div class="row mb-4">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <label asp-for="BirthDate" class="form-label fw-semibold">Doğum Tarihi</label>
                            <input asp-for="BirthDate" 
                                   type="date" 
                                   class="form-control form-control-lg" />
                            <span asp-validation-for="BirthDate" class="text-danger"></span>
                            <div class="form-text">Yaşınız otomatik olarak hesaplanacaktır</div>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Gender" class="form-label fw-semibold">Cinsiyet</label>
                            <select asp-for="Gender" class="form-select form-select-lg">
                                <option value="">Seçiniz...</option>
                                <option value="Erkek">Erkek</option>
                                <option value="Kadın">Kadın</option>
                                <option value="Belirtmek istemiyorum">Belirtmek istemiyorum</option>
                            </select>
                            <span asp-validation-for="Gender" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Meslek -->
                    <div class="mb-4">
                        <label asp-for="Profession" class="form-label fw-semibold">Meslek</label>
                        <input asp-for="Profession" 
                               class="form-control form-control-lg" 
                               placeholder="Mesleğinizi girin..." />
                        <span asp-validation-for="Profession" class="text-danger"></span>
                    </div>

                    <!-- İletişim Bilgileri -->
                    <div class="row mb-4">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <label asp-for="Email" class="form-label fw-semibold">E-posta</label>
                            <input asp-for="Email" 
                                   type="email" 
                                   class="form-control form-control-lg" 
                                   placeholder="ornek@email.com" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Phone" class="form-label fw-semibold">Telefon</label>
                            <input asp-for="Phone" 
                                   type="tel" 
                                   class="form-control form-control-lg" 
                                   placeholder="05XX XXX XX XX" />
                            <span asp-validation-for="Phone" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- İlgi Alanları -->
                    <div class="mb-4">
                        <label asp-for="Interests" class="form-label fw-semibold">İlgi Alanları ve Hobiler</label>
                        <textarea asp-for="Interests" 
                                  class="form-control" 
                                  rows="4" 
                                  placeholder="İlgi alanlarınızı ve hobilerinizi virgülle ayırarak yazın (örn: Kitap okumak, Yürüyüş, Müzik, Resim)"></textarea>
                        <span asp-validation-for="Interests" class="text-danger"></span>
                        <div class="form-text">İlgi alanlarınızı virgülle ayırarak yazın</div>
                    </div>

                    <!-- Form Butonları -->
                    <div class="d-flex flex-column flex-sm-row gap-3 justify-content-between pt-3 border-top">
                        <a asp-controller="Profile" asp-action="Show" asp-route-id="@Model.Id" class="btn btn-outline-secondary">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2">
                                <line x1="19" y1="12" x2="5" y2="12"></line>
                                <polyline points="12 19 5 12 12 5"></polyline>
                            </svg>
                            İptal
                        </a>
                        <button type="submit" class="btn btn-success btn-lg">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                <polyline points="7 3 7 8 15 8"></polyline>
                            </svg>
                            Değişiklikleri Kaydet
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Profil fotoğrafı önizleme
            const profileImageInput = document.getElementById('profileImageInput');
            const imagePreview = document.getElementById('imagePreview');
            const previewImage = document.getElementById('previewImage');
            const removeImageBtn = document.getElementById('removeImageBtn');
            const currentProfileImage = document.getElementById('currentProfileImage');

            if (profileImageInput && imagePreview && previewImage && removeImageBtn) {
                profileImageInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // Dosya boyutu kontrolü (5MB)
                        const maxSize = 5 * 1024 * 1024;
                        if (file.size > maxSize) {
                            showToast('Dosya çok büyük', 'Profil fotoğrafı maksimum 5MB olabilir. Lütfen daha küçük bir dosya seçin.', 'error');
                            profileImageInput.value = '';
                            imagePreview.style.display = 'none';
                            return;
                        }

                        // Dosya tipi kontrolü
                        if (!file.type.startsWith('image/')) {
                            showToast('Geçersiz dosya tipi', 'Lütfen bir görsel dosyası seçin (JPG, PNG, GIF).', 'error');
                            profileImageInput.value = '';
                            imagePreview.style.display = 'none';
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewImage.src = e.target.result;
                            imagePreview.style.display = 'block';
                            if (currentProfileImage) {
                                currentProfileImage.style.opacity = '0.5';
                            }
                        };
                        reader.readAsDataURL(file);
                    } else {
                        imagePreview.style.display = 'none';
                        if (currentProfileImage) {
                            currentProfileImage.style.opacity = '1';
                        }
                    }
                });

                removeImageBtn.addEventListener('click', function() {
                    profileImageInput.value = '';
                    imagePreview.style.display = 'none';
                    previewImage.src = '';
                    if (currentProfileImage) {
                        currentProfileImage.style.opacity = '1';
                    }
                });
            }
        });
    </script>
}

